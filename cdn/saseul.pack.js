/*
SASEUL JS
(c) 2016-2022 by ArtiFriends. All rights reserved.
https://saseul.com
*/
var SASEUL=SASEUL||function(){var s={},c=s.Core={hash:function(algo,string){return CryptoJS[algo](string).toString(CryptoJS.enc.Hex)},time:function(){return parseInt(new Date().getTime()/1000)},utime:function(){return parseInt((new Date().getTime())+'000')},randomHexString:function(n){var h='';for(var i=0;i<n*2;i+=1){var r=Math.floor(Math.random()*16);h+=r.toString(16)}return h},hexToByte:function(o){if(!o){return new Uint8Array()}var a=[];for(var i=0,l=o.length;i<l;i+=2){a.push(parseInt(o.substr(i,2),16))}return new Uint8Array(a)},byteToHex:function(o){if(!o){return ''}var s='';for(var i=0;i<o.length;i+=1){var h=(o[i]&0xff).toString(16);h=(h.length===1)?'0'+h:h;s+=h}return s.toLowerCase()},stringToByte:function(o){var b=new Uint8Array(new ArrayBuffer(o.length));for(var i=0,l=o.length;i<l;i+=1){b[i]=o.charCodeAt(i)}return b},stringToUnicode:function(o){if(!o){return ''}let u='';for(let i=0;i<o.length;i+=1){let c=o[i].charCodeAt(0).toString(16);if(c.length>2){u+='\\u'+c}else{u+=o[i]}}return u}};return s}();
(function(){var s=SASEUL,c=s.Core,f=s.Enc={SHORT_HASH_SIZE:40,ID_HASH_SIZE:44,HASH_SIZE:64,HEX_TIME_SIZE:14,TIME_HASH_SIZE:78,string:function(o){if(typeof o!=='string'){o=JSON.stringify(o)}return c.stringToUnicode(o.replaceAll('/','\\/'))},hash:function(o){return c.hash('SHA256',this.string(o))},shortHash:function(o){return c.hash('RIPEMD160',this.hash(o))},checksum:function(h){return c.hash('SHA256',c.hash('SHA256',h)).substr(0,4)},hextime:function(u){if(typeof u!=='number'){u=c.utime()}u=u.toString(16);if(u.length>this.HEX_TIME_SIZE){return u.substr(0,this.HEX_TIME_SIZE)}return u.toString(16).padStart(this.HEX_TIME_SIZE,'0')},timeHash:function(o,u){return this.hextime(u)+this.hash(o)},timeHashValidity:function(h){return this.isHex(h)===true&&h.length===this.TIME_HASH_SIZE},idHash:function(o){var h=this.shortHash(o);return h+this.checksum(h)},idHashValidity:function(i){return this.isHex(i)===true&&i.length===this.ID_HASH_SIZE&&this.checksum(i.substr(0,this.SHORT_HASH_SIZE))===i.substr(-4)},spaceId:function(w,s){return this.hash([w,s])},txHash:function(t){return this.timeHash(this.hash(t),t.timestamp)},isHex:function(h){if(typeof h!=='string'){return false}return(Boolean(h.match(/^[0-9a-f]+$/)))}}})();
(function(){var s=SASEUL,c=s.Core,e=s.Enc,f=s.Sign={KEY_SIZE:64,SIGNATURE_SIZE:128,keyPair:function(){var p=nacl.sign.keyPair();var k={};k.private_key=c.byteToHex(p.secretKey).substr(0,64);k.public_key=c.byteToHex(p.publicKey);k.address=this.address(k.public_key);return k},privateKey:function(){return c.byteToHex(nacl.sign.keyPair().secretKey).substr(0,64)},publicKey:function(k){return c.byteToHex(nacl.sign.keyPair.fromSeed(c.hexToByte(k)).publicKey)},address:function(k){return e.idHash(k)},addressValidity:function(a){return e.idHashValidity(a)},signature:function(o,k){return c.byteToHex(nacl.sign.detached(c.stringToByte(e.string(o)),c.hexToByte(k+this.publicKey(k))))},signatureValidity:function(o,k,g){return g.length===this.SIGNATURE_SIZE&&e.isHex(g)===true&&nacl.sign.detached.verify(c.stringToByte(o),c.hexToByte(g),c.hexToByte(k))},keyValidity:function(k){return k.length===this.KEY_SIZE&&e.isHex(k)}}})();
!function(){var t=SASEUL,e=t.Core,n=t.Enc,r=t.Sign,o=t.Rpc={default_peers:["main.saseul.net","aroma.saseul.net","blanc.saseul.net"],ping:function(t){return"object"!=typeof t&&(t=this.default_peers),new Promise((function(e){o._searchPeers(t,(function(t){o._queryRounds(t,(function(t){e(t)}))}))}))},searchPeers:function(t){return"object"!=typeof t&&(t=this.default_peers),new Promise((function(e){o._searchPeers(t,(function(t){e(t)}))}))},_searchPeers:function(t,e){o.multi(t,"/peer",{method:"POST",mode:"cors"},(function(t){var n=[];t.forEach((function(t){try{Object.values(t.data.peers).forEach((function(t){n.push(t.host)}))}catch(t){}})),e([...new Set(n)])}))},queryRounds:function(t){return"object"!=typeof t&&(t=this.default_peers),new Promise((function(e){o._queryRounds(t,(function(t){e(t)}))}))},_queryRounds:function(t,e){o.multi(t,"/round?chain_type=all",{method:"POST",mode:"cors"},(function(t){var n=[];t.forEach((function(t){try{n.push({host:t.host,main:t.data.main.block,resource:t.data.resource.block})}catch(t){}})),e(n)}))},transaction:function(t,e){return this.data(t,e)},request:function(t,e){return"string"!=typeof e&&(e=r.privateKey()),this.data(t,e,"request")},data:function(t,o,s="transaction"){var u={};try{return t.from=r.address(r.publicKey(o)),"number"!=typeof t.timestamp&&(t.timestamp=e.utime()),u[s]=t,u.public_key=r.publicKey(o),u.signature=r.signature(n.txHash(t),o),u}catch(t){return r.keyValidity(o)?(console.error(t),{}):(console.error("Invalid private key: "+o),{})}},send:function(t,e){var r,s=new FormData;return"string"!=typeof e?(console.error("The host URL is required. "),new Promise((function(t){t({code:999,msg:"The host URL is required. "})}))):("object"==typeof t.transaction?(s.append("transaction",n.string(t.transaction)),r=e+"/sendtransaction"):(s.append("request",n.string(t.request)),r=e+"/request"),s.append("public_key",t.public_key),s.append("signature",t.signature),new Promise((function(t){o._send(s,r,(function(e){t(e)}))})))},_send:function(t,e,n){fetch(o.wrapProtocol(e),{method:"POST",mode:"cors",body:t}).then((function(t){return t.json()}),(function(t){return{code:999,msg:t.message}})).then((function(t){n(t)}))},multi:function(t,e,n,r,s=9){var u=[],i=0,c=Math.min(t.length,s);(t=this.shuffle(t)).forEach((function(t,s){s<c&&fetch(o.wrapProtocol(t+e),n).then((function(t){return t.json()}),(function(t){return{code:999,msg:t.message}})).then((function(e){try{u.push({host:t,data:e.data})}catch(t){}if(i++==c-1)try{r(u)}catch(t){}}))}))},shuffle:function(t){return t.map((t=>({v:t,i:Math.random()}))).sort(((t,e)=>t.i-e.i)).map((({v:t})=>t))},wrapProtocol:function(t){return"http://"===t.substring(0,7)||"https://"===t.substring(0,8)||"//"===t.substring(0,2)?t:"//"+t}}}();
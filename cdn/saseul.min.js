/*
SASEUL JS
https://github.com/saseul/saseul-js
(c) 2016-2023 by ArtiFriends Inc. All rights reserved.
https://github.com/saseul/saseul-js/blob/master/LICENSE.md
*/
var SASEUL=SASEUL||{};SASEUL.Util={time:function(){return parseInt((new Date).getTime()/1e3)},utime:function(){return parseInt((new Date).getTime()+"000")},uceiltime:function(){return 1e6*(this.time()+1)},randomHexString:function(t){for(var n="",r=0;r<2*t;r++)n+=Math.floor(16*Math.random()).toString(16);return n},hexToByte:function(t){if(!t)return new Uint8Array;for(var n=[],r=0,e=t.length;r<e;r+=2)n.push(parseInt(t.substr(r,2),16));return new Uint8Array(n)},byteToHex:function(t){if(!t)return"";for(var n="",r=0;r<t.length;r++){var e=(255&t[r]).toString(16);n+=e=1===e.length?"0"+e:e}return n.toLowerCase()},stringToByte:function(t){for(var n=new Uint8Array(new ArrayBuffer(t.length)),r=0,e=t.length;r<e;r++)n[r]=t.charCodeAt(r);return n},stringToUnicode:function(t){if(!t)return"";let n="";for(let r=0;r<t.length;r++){let e=t[r].charCodeAt(0).toString(16);e.length>2?n+="\\u"+e:n+=t[r]}return n},wrappedEndpoint:function(t){return"http://"===t.substring(0,7)||"https://"===t.substring(0,8)||"//"===t.substring(0,2)?t:"//"+t},shuffle:function(t){return t.map((t=>({v:t,i:Math.random()}))).sort(((t,n)=>t.i-n.i)).map((({v:t})=>t))}};!function(){var t=SASEUL,n=t.Util;t.Enc={SHORT_HASH_SIZE:40,ID_HASH_SIZE:44,HASH_SIZE:64,HEX_TIME_SIZE:14,TIME_HASH_SIZE:78,ZERO_ADDRESS:"00000000000000000000000000000000000000000000",string:function(t){return"string"!=typeof t&&(t=JSON.stringify(t)),n.stringToUnicode(t.replaceAll("/","\\/"))},crypto:function(t,n){return CryptoJS[t](n).toString(CryptoJS.enc.Hex)},hash:function(t){return this.crypto("SHA256",this.string(t))},shortHash:function(t){return this.crypto("RIPEMD160",this.hash(t))},checksum:function(t){return this.hash(this.hash(t)).substring(0,4)},hextime:function(t){return"number"!=typeof t&&(t=n.utime()),(t=t.toString(16)).length>this.HEX_TIME_SIZE?t.substring(0,this.HEX_TIME_SIZE):t.toString(16).padStart(this.HEX_TIME_SIZE,"0")},timeHash:function(t,n){return this.hextime(n)+this.hash(t)},timeHashValidity:function(t){return!0===this.isHex(t)&&t.length===this.TIME_HASH_SIZE},idHash:function(t){var n=this.shortHash(t);return n+this.checksum(n)},idHashValidity:function(t){return!0===this.isHex(t)&&t.length===this.ID_HASH_SIZE&&this.checksum(t.substring(0,this.SHORT_HASH_SIZE))===t.substr(-4)},spaceId:function(t,n){return this.hash([t,n])},cid:function(t,n){return this.spaceId(t,n)},txHash:function(t){return this.timeHash(this.hash(t),t.timestamp)},isHex:function(t){return"string"==typeof t&&Boolean(t.match(/^[0-9a-f]+$/))},parseCode:function(t){return"string"==typeof t&&(t=JSON.parse(t)),void 0===t.w?{cid:SASEUL.Enc.spaceId(t.writer,t.nonce),name:t.name??"",writer:t.writer??"",type:t.type??"",version:t.version??"0",parameters:t.parameters??{},nonce:t.nonce??""}:{cid:SASEUL.Enc.spaceId(t.w,t.s),name:t.n??"",writer:t.w??"",type:t.t??"",version:t.v??"0",parameters:t.p??{},nonce:t.s??""}}}}();!function(){var e=SASEUL,i=e.Util,t=e.Enc;e.Sign={KEY_SIZE:64,SIGNATURE_SIZE:128,keyPair:function(){var e=nacl.sign.keyPair(),t={};return t.private_key=i.byteToHex(e.secretKey).substring(0,64),t.public_key=i.byteToHex(e.publicKey),t.address=this.address(t.public_key),t},privateKey:function(){return i.byteToHex(nacl.sign.keyPair().secretKey).substring(0,64)},publicKey:function(e){return i.byteToHex(nacl.sign.keyPair.fromSeed(i.hexToByte(e)).publicKey)},address:function(e){return t.idHash(e)},addressValidity:function(e){return t.idHashValidity(e)},signature:function(e,n){return i.byteToHex(nacl.sign.detached(i.stringToByte(t.string(e)),i.hexToByte(n+this.publicKey(n))))},signatureValidity:function(e,n,r){return r.length===this.SIGNATURE_SIZE&&!0===t.isHex(r)&&nacl.sign.detached.verify(i.stringToByte(t.string(e)),i.hexToByte(r),i.hexToByte(n))},keyValidity:function(e){return e.length===this.KEY_SIZE&&t.isHex(e)}}}();!function(){var n=SASEUL,t=n.Util,e=n.Enc,i=n.Sign,o=n.Rpc={_endpoint:"",_peers:[],endpoint:function(n){return void 0===n?this._endpoint:"string"!=typeof n?(console.error("endpoint should be of string type."),this._endpoint):(this._endpoint=n,this._endpoint)},peer:function(){return new Promise((function(n,t){o.tracker().then((function(t){let e=[];if(void 0!==t.data)for(let n in t.data.peers)e.push(t.data.peers[n]);n(e)})).catch((function(n){t(n)}))}))},tracker:function(){return o.call("/peer",[],!0)},call:function(n,e,i=!1){return""===this.endpoint()?(console.error('Please use the "SASEUL.Rpc.endpoint" function to set the endpoint for invoking RPC.'),[]):new Promise((function(a,r){axios({method:"POST",url:t.wrappedEndpoint(o.endpoint())+n,data:e,timeout:1e3}).then((function(n){void 0!==n.data.code?void 0!==n.data.data&&!1===i?a(n.data.data):a(n.data):r(n.data)})).catch((function(n){void 0===n.response?r(n):void 0===n.response.data?r(n.response):a(n.response.data)}))}))},ping:function(){return this.call("/ping",[],!0)},round:function(){return this.call("/round",{chain_type:"all"},!0)},signedTransaction:function(n,t){return this.signedData(n,t)},signedRequest:function(n,t){return this.signedData(n,t,"request")},signedData:function(n,o,a="transaction"){if(void 0===o&&(o=SASEUL.Sign.privateKey()),!i.keyValidity(o))return console.error("Invalid private key: "+o),{};let r={};return n.from=i.address(i.publicKey(o)),"number"!=typeof n.timestamp&&(n.timestamp=t.utime()+1e6),r[a]=n,r.public_key=i.publicKey(o),r.signature=i.signature(e.txHash(n),o),r},estimatedFee:function(n){let t="",i=JSON.stringify(n).length;return t+="transaction="+encodeURIComponent(e.string(n.transaction)),t+="&public_key="+n.public_key,t+="&signature="+n.signature,new Promise((function(n,e){o.call("/weight",t,!1).then((function(t){parseInt(i)===parseInt(t)?n(1e9*(parseInt(i)+336)):n(1e9*parseInt(t))})).catch(e)}))},request:function(n){return this.call("/rawrequest",e.string(n),!0)},sendTransaction:function(n){return this.call("/sendrawtransaction",e.string(n),!0)},_broadcast:function(n,i){axios({method:"POST",url:t.wrappedEndpoint(n)+"/sendrawtransaction",data:e.string(i),timeout:1e3}).then().catch((function(n){}))},broadcastTransaction:function(n){return new Promise((function(t,e){o.peer().then((function(i){i.length>1?(i.sort(((n,t)=>n.address.localeCompare(t.address))),o.sendTransaction(n).then((function(e){if(200===e.code){let t=i.length-1;for(let t=1;t<i.length;t*=2)o._broadcast(i[t-1].host,n),o._broadcast(i[t].host,n);o._broadcast(i[t-1].host,n),o._broadcast(i[t].host,n)}t(e)})).catch((function(n){e(n)}))):1===i.length&&o.sendTransaction(n).then((function(n){t(n)})).catch((function(n){e(n)}))})).catch((function(n){e(n)}))}))}}}();
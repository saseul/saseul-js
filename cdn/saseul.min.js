/*
SASEUL JS
https://github.com/saseul/saseul-js
(c) 2016-2023 by ArtiFriends Inc. All rights reserved.
https://github.com/saseul/saseul-js/blob/master/LICENSE.md
*/
var SASEUL=SASEUL||{};SASEUL.Util={time:function(){return Math.floor(Date.now()/1e3)},utime:function(){return 1e3*Date.now()},uceiltime:function(){return 1e6*Math.ceil(Date.now()/1e3)},randomHexString:function(t){let n="";for(let e=0;e<2*t;e++)n+=Math.floor(16*Math.random()).toString(16);return n},hexToByte:function(t){if(!t)return new Uint8Array;let n=[];for(let e=0,r=t.length;e<r;e+=2)n.push(parseInt(t.slice(e,e+2),16));return new Uint8Array(n)},byteToHex:function(t){return t?Array.prototype.map.call(t,(function(t){return("0"+(255&t).toString(16)).slice(-2)})).join("").toLowerCase():""},stringToByte:function(t){let n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n},stringToUnicode:function(t){return t?Array.prototype.map.call(t,(function(t){let n=t.charCodeAt(0).toString(16);return n.length>2?"\\u"+n:t})).join(""):""},isIP:function(t){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:([0-9]{1,5}))?$/.test(t)},isHex:function(t){return"string"==typeof t&&(/^[0-9a-fA-F]+$/.test(t)&&t.length%2==0)},isInt:function(t){return("number"==typeof t||"string"==typeof t)&&Number.isInteger(Number(t))&&!/^0[0-9a-fA-F]+$/.test(t)},isNumeric:function(t){return!("number"!=typeof t&&"string"!=typeof t||isNaN(Number(t))||Number(t)===1/0||/^0[0-9a-fA-F]+$/.test(n))},wrappedEndpoint:function(t){return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("//")?t:this.isIP(t)?"http://"+t:"//"+t},string:function(t){let n;return n="object"==typeof t&&null!==t?JSON.stringify(t):String(t),this.stringToUnicode(n.replace(/\//g,"\\/"))},shuffle:function(t){return t.map((t=>({v:t,i:Math.random()}))).sort(((t,n)=>t.i-n.i)).map((({v:t})=>t))},merge:function(t,n){let e=t.concat(n);return[...new Set(e)]},flatMerge:function(t){let n=t.flat();return[...new Set(n)]},randomSlice:function(t,n){return this.shuffle(t).slice(0,n)}};!function(){var t=SASEUL,i=t.Util;t.Enc={SHORT_HASH_SIZE:40,ID_HASH_SIZE:44,HASH_SIZE:64,HEX_TIME_SIZE:14,TIME_HASH_SIZE:78,ZERO_ADDRESS:"00000000000000000000000000000000000000000000",string:function(t){return i.string(t)},crypto:function(t,i){return CryptoJS[t](i).toString(CryptoJS.enc.Hex)},hash:function(t){return this.crypto("SHA256",this.string(t))},shortHash:function(t){return this.crypto("RIPEMD160",this.hash(t))},checksum:function(t){return this.hash(this.hash(t)).slice(0,4)},hextime:function(t){return"number"!=typeof t&&(t=i.utime()),t.toString(16).padStart(this.HEX_TIME_SIZE,"0").slice(0,this.HEX_TIME_SIZE)},timeHash:function(t,i){return this.hextime(i)+this.hash(t)},timeHashValidity:function(t){return!0===this.isHex(t)&&t.length===this.TIME_HASH_SIZE},idHash:function(t){let i=this.shortHash(t);return i+this.checksum(i)},idHashValidity:function(t){return this.isHex(t)&&t.length===this.ID_HASH_SIZE&&this.checksum(t.slice(0,this.SHORT_HASH_SIZE))===t.slice(-4)},spaceId:function(t,i){return this.hash([t,i])},cid:function(t,i){return this.spaceId(t,i)},txHash:function(t){return this.timeHash(this.hash(t),t.timestamp)},isHex:function(t){return i.isHex(t)},parseCode:function(t){return"string"==typeof t&&(t=JSON.parse(t)),void 0===t.w?{cid:SASEUL.Enc.spaceId(t.writer,t.nonce),name:t.name??"",writer:t.writer??"",type:t.type??"",version:t.version??"0",parameters:t.parameters??{},nonce:t.nonce??""}:{cid:SASEUL.Enc.spaceId(t.w,t.s),name:t.n??"",writer:t.w??"",type:t.t??"",version:t.v??"0",parameters:t.p??{},nonce:t.s??""}}}}();!function(){var e=SASEUL,t=e.Util,i=e.Enc;e.Sign={KEY_SIZE:64,SIGNATURE_SIZE:128,keyPair:function(){let e=nacl.sign.keyPair(),i={};return i.private_key=t.byteToHex(e.secretKey).slice(0,this.KEY_SIZE),i.public_key=t.byteToHex(e.publicKey),i.address=this.address(i.public_key),i},privateKey:function(){return t.byteToHex(nacl.sign.keyPair().secretKey).slice(0,this.KEY_SIZE)},publicKey:function(e){return t.byteToHex(nacl.sign.keyPair.fromSeed(t.hexToByte(e)).publicKey)},address:function(e){return i.idHash(e)},addressValidity:function(e){return i.idHashValidity(e)},signature:function(e,n){return t.byteToHex(nacl.sign.detached(t.stringToByte(i.string(e)),t.hexToByte(n+this.publicKey(n))))},signatureValidity:function(e,n,r){return r.length===this.SIGNATURE_SIZE&&!0===i.isHex(r)&&nacl.sign.detached.verify(t.stringToByte(i.string(e)),t.hexToByte(r),t.hexToByte(n))},keyValidity:function(e){return"string"==typeof e&&/^[a-fA-F0-9]{64}$/.test(e)}}}();!function(){var e=SASEUL,t=e.Util,n=e.Enc,s=e.Sign,a=e.Rpc={_default_peers:["https://main.saseul.net","https://sub.saseul.net","https://aroma.saseul.net","https://blanc.saseul.net"],_endpoints:null,_timeout:3e4,_headers:{},_broadcast_limit:32,endpoint:function(e){const t=this.endpoints(e);return t[Math.floor(Math.random()*t.length)]},endpoints:function(e){return"object"==typeof e?this._endpoints=Object.values(e):void 0!==e&&(this._endpoints=[String(e)]),this._endpoints?this._endpoints:this._default_peers},timeout:function(e){return"number"==typeof e&&e>0&&(this._timeout=e),this._timeout},headers:function(e){return"object"==typeof e&&(this._headers=e),this._headers},broadcastLimit:function(e){return"number"==typeof e&&e>0&&(this._broadcast_limit=e),this._broadcast_limit},tracker:function(){return this.get("peer",{})},trackerFromAll:function(){return new Promise(((e,n)=>{a.all("GET","peer",{}).then((s=>{let a={peers:[],known_hosts:[]};s.forEach((e=>{e.data&&e.data.peers&&e.data.known_hosts&&"object"==typeof e.data.peers&&Array.isArray(e.data.known_hosts)&&(a.peers.push(Object.values(e.data.peers)),a.known_hosts.push(e.data.known_hosts))})),a.peers.length>0?(a.peers=t.flatMerge(a.peers),a.known_hosts=t.flatMerge(a.known_hosts),e(a)):n(s)}))}))},peer:function(){return new Promise(((e,t)=>{a.tracker().then((t=>e(Object.values(t.data.peers)))).catch(t)}))},peerFromAll:function(){return new Promise(((e,n)=>{a.all("GET","peer",{}).then((s=>{let a=[];s.forEach((e=>{e.data&&e.data.peers&&"object"==typeof e.data.peers&&a.push(Object.values(e.data.peers))})),a.length>0?(a=t.flatMerge(a),e(a)):n(s)}))}))},ping:function(){return this.get("ping",{})},round:function(){return this.get("round",{chain_type:"all"})},bestRound:function(){return new Promise(((e,t)=>{this.all("GET","round",{chain_type:"all"}).then((n=>{let s=n,a=Math.max(...s.map((e=>e.data?e.data.main.block.height:0))),r=Math.max(...s.map((e=>e.data?e.data.resource.block.height:0))),o=s.find((e=>e.data&&e.data.main.block.height===a)),i=s.find((e=>e.data&&e.data.resource.block.height===r));o&&i?e({main:o.data.main.block,resource:i.data.resource.block}):t({main:null,resource:null})})).catch(t)}))},signedRequest:function(e,t){return this.signedData(e,t,"request")},simpleRequest:function(e){return{request:e}},signedTransaction:function(e,t){return this.signedData(e,t,"transaction")},request:function(e){return this.get("request",e)},raceRequest:function(e,t=(()=>!0)){return this.race("GET","request",e,t)},sendTransaction:function(e){return this.post("sendtransaction",e)},sendTransactionToAll:function(e){return this.all("POST","sendtransaction",e)},broadcastTransaction:function(e){return new Promise(((n,s)=>{this.peerFromAll().then((r=>{let o=a.broadcastLimit()-a.endpoints().length,i=t.merge(a.endpoints(),t.randomSlice(r,o).map((e=>e.host)));a._all(i,"POST","sendtransaction",e,(()=>!0),(e=>{let t=e.filter((e=>200===e.code));if(t.length>0)n(t[0]);else{let t=Math.max(...e.map((e=>e.code))),n=e.filter((e=>e.code===t));n.length>0?s(n[0]):s(e[0])}}))})).catch(s)}))},estimatedFee:function(e){const n=JSON.stringify(e).length;return new Promise(((s,a)=>{this.race("POST","weight",e,t.isInt).then((e=>{let t=parseInt(e.data||"0");s(t===n?1e9*(n+336):1e9*t)})).catch((e=>{a(e)}))}))},get:function(e,t){return this.fetch("GET",e,t)},post:function(e,t){return this.fetch("POST",e,t)},fetch:function(e,t,n){return new Promise((function(s,r){let o=a.axiosItem(a.endpoint(),e,t,n,a.headers());axios(o).then((e=>{e.data&&e.data.code?s(e.data):r({code:901,msg:"Invalid response parameter"})})).catch((e=>{"ECONNABORTED"===e.code||e.message.includes("timeout")?r({code:408,msg:"Request timed out"}):e.response&&e.response.data&&e.response.data.code?s(e.response.data):e.response.status&&e.response.statusText&&e.response.data?r({code:e.response.status,msg:e.response.statusText,data:e.response.data}):r(e)}))}))},signedData:function(e,a,r="transaction"){if(a||(a=SASEUL.Sign.privateKey()),!s.keyValidity(a))return console.error("Invalid private key: "+a),{};let o={};return e.from=s.address(s.publicKey(a)),"number"!=typeof e.timestamp&&(e.timestamp=t.utime()+("transaction"===r?2e6:0)),o[r]=e,o.public_key=s.publicKey(a),o.signature=s.signature(n.txHash(e),a),o},axiosItem:function(e,n,s,r,o){let i={method:n,url:`${t.wrappedEndpoint(e)}/${s}`,timeout:a.timeout()};if("object"==typeof o&&Object.keys(o).length>0&&(i.headers=o),"GET"===n){let e=[];for(let n in r)e.push(`${n}=${t.string(r[n])}`);i.url=i.url+(0===Object.keys(r).length?"":"?"+e.join("&"))}else{let e=new FormData;for(let n in r)e.set(n,t.string(r[n]));i.data=e}return i},race:function(e,t,n,s=(()=>!0)){const r=this.endpoints();return new Promise((function(o,i){a._race(r,e,t,n,s,o,i)}))},_race:function(e,t,n,s,r=(()=>!1),o=(()=>{}),i=(()=>{})){Array.isArray(e)&&0!==e.length||i();try{let c,d,u,l=0,p=new axios.CancelToken((e=>u=e)),h=e.map((h=>{d=a.axiosItem(h,t,n,s,a.headers()),d.cancelToken=p,axios(d).then((e=>{e.data&&e.data.code&&r(e.data.data)?(o(e.data),u()):l++})).catch((e=>{l++,c||(c="ECONNABORTED"===e.code||e.message.includes("timeout")?{code:408,msg:"Request timed out"}:e.response&&e.response.data&&e.response.data.code?e.response.data:e.response&&e.response.status?{code:e.response.status,msg:e.response.statusText,data:e.response.data}:e)})).finally((()=>l>=e.length&&i(c)))}));Promise.race(h).then()}catch(e){console.error(e)}},all:function(e,t,n,s=(()=>!0)){const r=this.endpoints();return new Promise((function(o){a._all(r,e,t,n,s,o)}))},_all:function(e,t,n,s,r=(()=>!0),o=(()=>{})){Array.isArray(e)&&0!==e.length||fallback();try{let i,c=[],d=e.map((d=>{i=a.axiosItem(d,t,n,s,a.headers()),axios(i).then((e=>{e.data&&e.data.code&&r(e.data.data)?c.push({endpoint:d,code:e.data.code,data:e.data.data}):c.push({endpoint:d,msg:"Condition not met"})})).catch((e=>{if("ECONNABORTED"===e.code||e.message.includes("timeout"))c.push({endpoint:d,code:408,msg:"Request timed out"});else if(e.response&&e.response.data&&e.response.data.code){let t=e.response.data;t.endpoint=d,c.push(t)}else e.response&&e.response.status?c.push({endpoint:d,code:e.response.status,msg:e.response.statusText,data:e.response.data}):c.push({endpoint:d,error:e})})).finally((()=>{c.length>=e.length&&o(c)}))}));Promise.race(d).then()}catch(e){console.error(e)}}}}();